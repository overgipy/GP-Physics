<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ææ·ç‰©ç† - é€²éšéƒ½åœå‹’æ•ˆæ‡‰æ¨¡æ“¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        h1 { color: #333; margin-bottom: 10px; }
        .canvas-container {
            position: relative;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        canvas {
            display: block;
            background-color: #1a1a2e;
        }
        /* æ¨™ç¤ºå·¦å³è§€å¯Ÿè€…çš„æ–‡å­— */
        .observer-label {
            position: absolute;
            top: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: bold;
            font-size: 1.2em;
            pointer-events: none;
        }
        .label-left { left: 20px; }
        .label-right { right: 20px; }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }
        .data-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid #ccc;
        }
        .card-source { border-top-color: #ff4757; }
        .card-left { border-top-color: #2ed573; }
        .card-right { border-top-color: #ffa502; }

        .data-card h3 { margin: 0 0 10px 0; font-size: 1.1em; color: #555; }
        .data-item { margin: 5px 0; font-size: 0.95em; color: #333; }
        .data-value { font-weight: bold; font-family: 'Courier New', monospace; font-size: 1.1em; }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 760px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        label { margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="range"] { width: 100%; cursor: pointer; }
        .value-display { font-size: 0.9em; color: #777; margin-top: 5px; }
        
        button#resetBtn {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            height: fit-content;
            align-self: center;
        }
        .alert { color: red; font-weight: bold; font-size: 0.8em; min-height: 1.2em;}
    </style>
</head>
<body>

    <h1>ğŸ“¡ é€²éšéƒ½åœå‹’æ•ˆæ‡‰æ¨¡æ“¬</h1>

    <div class="canvas-container">
        <span class="observer-label label-left">â¬…ï¸ å·¦å´è§€å¯Ÿè€… (èƒŒé›¢)</span>
        <span class="observer-label label-right">å³å´è§€å¯Ÿè€… (æ¥è¿‘) â¡ï¸</span>
        <canvas id="simulationCanvas" width="800" height="350"></canvas>
    </div>

    <div class="dashboard">
        <div class="data-card card-left">
            <h3>å·¦å´æ¥æ”¶ (èƒŒé›¢)</h3>
            <div class="data-item">è¦–æ³¢é•· Î»'ï¼š<span class="data-value" id="leftLambda">--</span> m</div>
            <div class="data-item">è¦–é »ç‡ f'ï¼š<span class="data-value" id="leftFreq">--</span> Hz</div>
        </div>
        
        <div class="data-card card-source">
            <h3>æ³¢æºåƒæ•¸ (Source)</h3>
            <div class="data-item">åŸå§‹æ³¢é•· Î»â‚€ï¼š<span class="data-value" id="sourceLambda">--</span> m</div>
            <div class="data-item">åŸå§‹é »ç‡ fâ‚€ï¼š<span class="data-value" id="sourceFreq">10.0</span> Hz</div>
        </div>

        <div class="data-card card-right">
            <h3>å³å´æ¥æ”¶ (æ¥è¿‘)</h3>
            <div class="data-item">è¦–æ³¢é•· Î»'ï¼š<span class="data-value" id="rightLambda">--</span> m</div>
            <div class="data-item">è¦–é »ç‡ f'ï¼š<span class="data-value" id="rightFreq">--</span> Hz</div>
            <div class="alert" id="shockwaveAlert"></div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label for="sourceSpeed">æ³¢æºé€Ÿåº¦ (Vs)</label>
            <input type="range" id="sourceSpeed" min="0" max="100" step="1" value="20">
            <span class="value-display"><span id="sourceSpeedVal">20</span> m/s</span>
        </div>
        <div class="control-group">
            <label for="waveSpeed">æ³¢å‚³éé€Ÿåº¦ (V)</label>
            <input type="range" id="waveSpeed" min="30" max="100" step="1" value="60">
            <span class="value-display"><span id="waveSpeedVal">60</span> m/s</span>
        </div>
        <button id="resetBtn">é‡ç½®æ¨¡æ“¬</button>
    </div>

    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI å…ƒç´ 
        const sourceSpeedInput = document.getElementById('sourceSpeed');
        const waveSpeedInput = document.getElementById('waveSpeed');
        const sourceSpeedValDisplay = document.getElementById('sourceSpeedVal');
        const waveSpeedValDisplay = document.getElementById('waveSpeedVal');
        
        // æ•¸æ“šé¡¯ç¤ºå…ƒç´ 
        const els = {
            srcLambda: document.getElementById('sourceLambda'),
            leftLambda: document.getElementById('leftLambda'),
            leftFreq: document.getElementById('leftFreq'),
            rightLambda: document.getElementById('rightLambda'),
            rightFreq: document.getElementById('rightFreq'),
            shockAlert: document.getElementById('shockwaveAlert')
        };

        let waves = [];
        let source = { x: 50, y: canvas.height / 2 };
        let time = 0;
        
        // ç‰©ç†åƒæ•¸ (ç‚ºäº†é¡¯ç¤ºæ–¹ä¾¿ï¼Œæˆ‘å€‘è¨­å®š 1 px = 1 mï¼Œä¸¦å›ºå®šç™¼æ³¢é€±æœŸ)
        const frameRate = 60; // å‡è¨­ç€è¦½å™¨è·‘ 60fps
        const wavePeriodFrames = 20; // æ¯ 20 frames ç™¼å‡ºä¸€å€‹æ³¢
        // è¨ˆç®—å‡ºçš„åŸå§‹é »ç‡ (åƒ…ç‚ºé¡¯ç¤ºåŸºæº–ï¼Œå‡è¨­ 1ç§’ = 60 frames)
        // f0 = 60 / 20 = 3 Hz. 
        // ç‚ºäº†è®“æ•¸å€¼å¥½çœ‹ï¼Œæˆ‘å€‘ã€Œå®šç¾©ã€é¡¯ç¤ºçš„ f0 ç‚º 10 Hzï¼Œä¸¦æ“šæ­¤ç¸®æ”¾é¡¯ç¤ºæ•¸å€¼
        const displayBaseFreq = 10; 

        // æ¨¡æ“¬åƒæ•¸
        let Vs = parseFloat(sourceSpeedInput.value); // m/s (px/frame * scale factor)
        let V = parseFloat(waveSpeedInput.value);    // m/s
        
        // ç‚ºäº†è®“å‹•ç•«æµæš¢ï¼Œæˆ‘å€‘å°‡ UI çš„æ•¸å€¼ (m/s) ç¸®å°ä¸€å®šæ¯”ä¾‹å°æ‡‰åˆ° canvas çš„ px/frame
        // å‡è¨­ UI é¡¯ç¤º 60 m/sï¼Œå¯¦éš›å‹•ç•«è·‘ 3 px/frame
        const speedScale = 0.05; 

        function updateValues() {
            Vs = parseFloat(sourceSpeedInput.value);
            V = parseFloat(waveSpeedInput.value);
            
            sourceSpeedValDisplay.textContent = Vs;
            waveSpeedValDisplay.textContent = V;

            calculateData();
        }

        function calculateData() {
            // ç‰©ç†å…¬å¼è¨ˆç®—å€
            // 1. åŸå§‹æ³¢é•· = æ³¢é€Ÿ / é »ç‡
            let lambda0 = V / displayBaseFreq;
            
            // 2. å³å´ (æ¥è¿‘)ï¼šÎ»' = (V - Vs) / f0
            let lambdaRight = (V - Vs) / displayBaseFreq;
            let freqRight = (lambdaRight > 0) ? (V / lambdaRight) : Infinity;

            // 3. å·¦å´ (èƒŒé›¢)ï¼šÎ»' = (V + Vs) / f0
            let lambdaLeft = (V + Vs) / displayBaseFreq;
            let freqLeft = V / lambdaLeft;

            // æ›´æ–° UI
            els.srcLambda.textContent = lambda0.toFixed(2);
            
            els.leftLambda.textContent = lambdaLeft.toFixed(2);
            els.leftFreq.textContent = freqLeft.toFixed(2);

            els.rightLambda.textContent = lambdaRight <= 0 ? "0.00" : lambdaRight.toFixed(2);
            els.rightFreq.textContent = (!isFinite(freqRight) || freqRight < 0) ? "âˆ (è¡æ“Šæ³¢)" : freqRight.toFixed(2);

            if (Vs >= V) {
                els.shockAlert.textContent = "âš ï¸ éŸ³çˆ†ç”¢ç”Ÿ (Vs â‰¥ V)";
                els.rightLambda.style.color = "red";
            } else {
                els.shockAlert.textContent = "";
                els.rightLambda.style.color = "#333";
            }
        }

        sourceSpeedInput.addEventListener('input', updateValues);
        waveSpeedInput.addEventListener('input', updateValues);
        document.getElementById('resetBtn').addEventListener('click', () => {
            source.x = 50;
            waves = [];
        });

        function draw() {
            // æ¸…é™¤ç•«å¸ƒ
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°æ³¢æºä½ç½® (ä¹˜ä¸Šç¸®æ”¾æ¯”ä¾‹è½‰æˆåƒç´ )
            source.x += Vs * speedScale;
            if (source.x > canvas.width + 50) {
                source.x = -50;
                waves = [];
            }

            // ç™¼å°„æ–°æ³¢
            time++;
            if (time % wavePeriodFrames === 0) {
                waves.push({
                    x: source.x,
                    y: source.y,
                    radius: 0,
                    opacity: 1
                });
            }

            // ç¹ªè£½æ³¢
            ctx.lineWidth = 2;
            for (let i = waves.length - 1; i >= 0; i--) {
                let w = waves[i];
                w.radius += V * speedScale; // æ³¢å‘å¤–æ“´æ•£
                w.opacity -= 0.002; // éš¨è·é›¢è®Šæ·¡

                if (w.opacity <= 0) {
                    waves.splice(i, 1);
                } else {
                    ctx.beginPath();
                    ctx.arc(w.x, w.y, w.radius, 0, Math.PI * 2);
                    // æ ¹æ“šéƒ½åœå‹’æ•ˆæ‡‰å¾®èª¿é¡è‰²ï¼Ÿ(ç´…ç§»/è—ç§») 
                    // é€™è£¡æš«æ™‚ä¿æŒè—è‰²ç³»ï¼Œé¿å…è¦–è¦ºå¤ªé›œ
                    ctx.strokeStyle = `rgba(100, 200, 255, ${w.opacity})`;
                    ctx.stroke();
                }
            }

            // ç¹ªè£½æ³¢æº
            ctx.beginPath();
            ctx.arc(source.x, source.y, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#ff4757';
            ctx.fill();

            requestAnimationFrame(draw);
        }

        // åˆå§‹åŒ–
        updateValues();
        draw();
    </script>
</body>
</html>
