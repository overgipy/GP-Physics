<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ°´æ³¢ç¹å°„ï¼šå¼·åº¦èˆ‡é—œä¿‚åˆ†æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .nav { width: 100%; padding: 10px; background: #333; }
        .nav a { color: #3498db; text-decoration: none; }
        .dashboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; width: 100%; max-width: 1000px; }
        .controls { background: #252525; padding: 20px; border-radius: 15px; flex: 1; min-width: 300px; border: 1px solid #444; }
        .analysis { background: #1e1e1e; padding: 20px; border-radius: 15px; flex: 1; min-width: 300px; border: 1px solid #00d4ff; }
        .slider-group { margin-bottom: 15px; }
        span { display: block; margin-bottom: 5px; font-size: 14px; color: #bbb; }
        b { color: #00d4ff; font-size: 18px; }
        .status-msg { margin-top: 10px; padding: 10px; border-radius: 5px; background: #333; color: #ffcc00; font-size: 14px; }
        canvas { border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="nav"><a href="../index.html">â† è¿”å›å¯¦é©—å®¤é¦–é </a></div>
    <h2>ğŸŒŠ æ°´æ³¢ç¹å°„ï¼šç¸«å¯¬èˆ‡æ³¢é•·é—œä¿‚å¯¦é©—</h2>
    
    <div class="dashboard">
        <div class="controls">
            <div class="slider-group">
                <span>æ³¢é•· (Î»): <b id="wL_val">30</b> px</span>
                <input type="range" id="waveL" min="15" max="60" value="30" style="width:100%">
            </div>
            <div class="slider-group">
                <span>ç‹¹ç¸«å¯¬åº¦ (a): <b id="sW_val">40</b> px</span>
                <input type="range" id="slitW" min="5" max="150" value="40" style="width:100%">
            </div>
        </div>
        
        <div class="analysis">
            <span>ç‰©ç†é—œä¿‚åˆ†æ (a / Î»):</span>
            <b id="ratio_val">1.33</b>
            <div id="comment" class="status-msg">æ­£åœ¨è¨ˆç®—...</div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        let wL_s, sW_s;
        const res = 5; // æ•ˆèƒ½è§£æåº¦

        function setup() {
            let cnv = createCanvas(800, 450);
            cnv.parent('canvas-container');
            wL_s = select('#waveL');
            sW_s = select('#slitW');
            textAlign(CENTER);
        }

        function draw() {
            background(10);
            let lambda = float(wL_s.value());
            let a = float(sW_s.value());
            let time = frameCount * 0.15;
            let ratio = a / lambda;

            // UI æ›´æ–°
            select('#wL_val').html(lambda);
            select('#sW_val').html(a);
            select('#ratio_val').html(ratio.toFixed(2));

            if (ratio < 1.1) {
                select('#comment').html("ğŸ”” ç¹å°„é¡¯è‘—ï¼šç¸«å¯¬æ¥è¿‘æ³¢é•·ï¼Œæ³¢å¹¾ä¹å‘ˆåœ“å½¢æ“´æ•£è‡³é™°å½±å€ã€‚");
            } else if (ratio < 3) {
                select('#comment').html("ğŸ†— ç¹å°„ä¸­ç­‰ï¼šå¯ä»¥çœ‹åˆ°æ˜é¡¯çš„ä¸­å¤®äº®å¸¶ã€‚");
            } else {
                select('#comment').html("âš ï¸ ç¹å°„ä¸æ˜é¡¯ï¼šç¸«å¯¬é å¤§æ–¼æ³¢é•·ï¼Œæ³¢å½¢è¶¨è¿‘æ–¼ç›´ç·šå‰é€²ã€‚");
            }

            // 1. ç¹ªè£½æ°´æ³¢æ¨¡æ“¬ (å·¦å´ 0~600)
            for (let x = 0; x < 600; x += res) {
                for (let y = 0; y < height; y += res) {
                    let amp = 0;
                    if (x < 150) {
                        amp = sin((x / lambda) * TWO_PI - time);
                    } else {
                        let dx = x - 150;
                        let num = 6; 
                        for (let i = 0; i < num; i++) {
                            let sy = (height/2 - a/2) + (a / (num-1 || 1)) * i;
                            let r = dist(x, y, 150, sy);
                            amp += sin((r / lambda) * TWO_PI - time) / sqrt(r*0.1 + 1);
                        }
                        amp /= num;
                    }
                    let c = map(amp, -1, 1, 0, 255);
                    fill(0, c * 0.6 + 30, c, 180);
                    rect(x, y, res, res);
                }
            }

            // 2. ç¹ªè£½å³å´å¼·åº¦åˆ†ä½ˆåœ– (600~800)
            fill(20);
            rect(600, 0, 200, height);
            stroke(0, 212, 255);
            noFill();
            beginShape();
            for (let y = 0; y < height; y += 5) {
                let angle = atan2(y - height/2, 450); // å‡è¨­è§€æ¸¬è·é›¢ç‚º 450
                let beta = (PI * a * sin(angle)) / lambda;
                let intens = (beta === 0) ? 1 : Math.pow(Math.sin(beta)/beta, 2);
                vertex(620 + intens * 150, y);
            }
            endShape();
            noStroke();
            fill(255);
            text("è§€æ¸¬å±å¼·åº¦ (I)", 700, 20);

            // 3. ç¹ªè£½æ“‹ç‰†
            fill(120);
            rect(150, 0, 15, height/2 - a/2);
            rect(150, height/2 + a/2, 15, height/2 - a/2);
            fill(255, 200, 0);
            text("éšœç¤™ç‰©", 157, 40);
        }
    </script>
</body>
</html>
