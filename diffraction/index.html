<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æ³¢ç¹å°„ï¼šè¡Œå‹•æ•™å­¸ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #121212; color: white; margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
        }
        .nav { width: 100%; margin-bottom: 15px; }
        .nav a { color: #3498db; text-decoration: none; font-size: 14px; }

        /* ä¸Šæ–¹æ§åˆ¶å€ */
        .controls-container {
            width: 100%; max-width: 600px;
            background: #252525; padding: 20px; border-radius: 15px;
            margin-bottom: 15px; box-sizing: border-box;
        }
        .slider-group { margin-bottom: 25px; }
        .slider-label { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px; }
        .slider-label b { color: #00d4ff; }
        input[type=range] {
            width: 100%; height: 25px; /* åŠ é«˜æ»‘æ¡¿æ–¹ä¾¿è§¸ç¢° */
            cursor: pointer;
        }

        /* ä¸­é–“ç•«å¸ƒå€ */
        #canvas-container { width: 100%; display: flex; justify-content: center; }
        canvas { border-radius: 8px; max-width: 100%; height: auto !important; }

        /* ä¸‹æ–¹åˆ†æå€ */
        .analysis-container {
            width: 100%; max-width: 600px;
            background: #1e1e1e; padding: 20px; border-radius: 15px;
            margin-top: 15px; border-left: 5px solid #00d4ff; box-sizing: border-box;
        }
        .ratio-text { font-size: 20px; margin-bottom: 10px; }
        .comment-text { color: #ffcc00; line-height: 1.5; font-size: 16px; }
    </style>
</head>
<body>
    <div class="nav"><a href="../index.html">â† è¿”å›é¦–é </a></div>

    <div class="controls-container">
        <div class="slider-group">
            <div class="slider-label">æ³¢é•· Î»: <b id="wL_val">30</b></div>
            <input type="range" id="waveL" min="15" max="60" value="30">
        </div>
        <div class="slider-group">
            <div class="slider-label">ç¸«å¯¬ w: <b id="sW_val">40</b></div>
            <input type="range" id="slitW" min="5" max="150" value="40">
        </div>
    </div>

    <div id="canvas-container"></div>

    <div class="analysis-container">
        <div class="ratio-text">é—œä¿‚æ¯”å€¼ (w / Î») = <b id="ratio_val">1.33</b></div>
        <div id="comment" class="comment-text">æ­£åœ¨åˆ†æç¹å°„ç¾è±¡...</div>
    </div>

    <script>
        let wL_s, sW_s;
        let canvasW, canvasH;

        function setup() {
            // æ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•èª¿æ•´ç•«å¸ƒå¤§å°
            canvasW = min(windowWidth - 20, 600);
            canvasH = canvasW * 0.6; 
            let cnv = createCanvas(canvasW, canvasH + 100); // ä¸‹æ–¹ç•™100pxç•«å¼·åº¦æ›²ç·š
            cnv.parent('canvas-container');
            wL_s = select('#waveL');
            sW_s = select('#slitW');
        }

        function draw() {
            background(10);
            let lambda = float(wL_s.value());
            let w = float(sW_s.value());
            let time = frameCount * 0.15;
            let ratio = w / lambda;

            // æ›´æ–°ä»‹é¢æ–‡å­—
            select('#wL_val').html(lambda);
            select('#sW_val').html(w);
            select('#ratio_val').html(ratio.toFixed(2));

            // æ›´æ–°è©•èª
            if (ratio < 1.1) {
                select('#comment').html("â­ ç¹å°„éå¸¸é¡¯è‘—ï¼šç¸«å¯¬æ¥è¿‘æ³¢é•·ï¼Œæ³¢å‰åœ¨ç¸«å¾Œå®Œæ•´å±•é–‹ã€‚");
            } else if (ratio < 3) {
                select('#comment').html("ğŸ”¹ ç¹å°„ä¸­ç­‰ï¼šæ³¢å‰æœ‰å½æ›²ï¼Œä½†ä»èƒ½çœ‹å‡ºä¸»è¦çš„è¡Œé€²æ–¹å‘ã€‚");
            } else {
                select('#comment').html("âš ï¸ ç¹å°„ä¸æ˜é¡¯ï¼šç¸«å¯¬é å¤§æ–¼æ³¢é•·ï¼Œå¹¾ä¹ç¶­æŒç›´ç·šå‚³æ’­ï¼ˆå¹¾ä½•å…‰å­¸æ¥µé™ï¼‰ã€‚");
            }

            // ç¹ªè£½æ°´æ³¢ (ä½”ç”¨ç•«å¸ƒä¸Šæ–¹éƒ¨åˆ†)
            let waveAreaH = canvasH;
            let res = 6; 
            for (let x = 0; x < canvasW; x += res) {
                for (let y = 0; y < waveAreaH; y += res) {
                    let amp = 0;
                    if (x < canvasW * 0.25) {
                        amp = sin((x / lambda) * TWO_PI - time);
                    } else {
                        let dx = x - canvasW * 0.25;
                        let num = 5; 
                        for (let i = 0; i < num; i++) {
                            let sy = (waveAreaH/2 - w/2) + (w / (num-1 || 1)) * i;
                            let r = dist(x, y, canvasW * 0.25, sy);
                            amp += sin((r / lambda) * TWO_PI - time) / sqrt(r*0.1 + 1);
                        }
                        amp /= num;
                    }
                    let c = map(amp, -1, 1, 0, 255);
                    fill(0, c * 0.6 + 30, c, 180);
                    noStroke();
                    rect(x, y, res, res);
                }
            }

            // ç¹ªè£½æ“‹ç‰†
            fill(150);
            rect(canvasW * 0.25, 0, 10, waveAreaH/2 - w/2);
            rect(canvasW * 0.25, waveAreaH/2 + w/2, 10, waveAreaH/2 - w/2);

            // ç¹ªè£½ä¸‹æ–¹å¼·åº¦åˆ†ä½ˆæ›²ç·š (åœ¨æ°´æ³¢åœ–æ­£ä¸‹æ–¹)
            push();
            translate(0, waveAreaH);
            fill(30);
            rect(0, 0, canvasW, 100);
            stroke(0, 212, 255);
            strokeWeight(2);
            noFill();
            beginShape();
            for (let x = 0; x < canvasW; x += 2) {
                let angle = map(x, 0, canvasW, -PI/3, PI/3);
                let beta = (PI * w * sin(angle)) / lambda;
                let intens = (beta === 0) ? 1 : Math.pow(Math.sin(beta)/beta, 2);
                vertex(x, 90 - intens * 70);
            }
            endShape();
            noStroke();
            fill(255);
            textSize(12);
            text("è¡å°„å¼·åº¦æ›²ç·šåˆ†å¸ƒ (I)", 10, 20);
            pop();
        }

        // è¢å¹•æ—‹è½‰æˆ–èª¿æ•´å¤§å°æ™‚é‡æ–°é©æ‡‰
        function windowResized() {
            canvasW = min(windowWidth - 20, 600);
            canvasH = canvasW * 0.6;
            resizeCanvas(canvasW, canvasH + 100);
        }
    </script>
</body>
</html>
