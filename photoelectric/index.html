<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…‰é›»æ•ˆæ‡‰å¯¦é©— - é€²éšç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #000; color: #eee; margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            overscroll-behavior: none;
        }
        .nav { width: 100%; margin-bottom: 10px; }
        .nav a { color: #00d4ff; text-decoration: none; font-size: 14px; }

        /* æ§åˆ¶é¢æ¿ */
        .controls-container {
            width: 100%; max-width: 600px;
            background: #1a1a1a; padding: 15px 20px; border-radius: 12px;
            margin-bottom: 15px; box-sizing: border-box; border: 1px solid #333;
        }
        .slider-group { margin-bottom: 15px; }
        .slider-group:last-child { margin-bottom: 0; }
        .slider-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; color: #ccc; }
        .slider-label b { color: #00d4ff; font-family: monospace; font-size: 1.1em; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #00d4ff; cursor: pointer; margin-top: -8px; box-shadow: 0 0 8px rgba(0,212,255,0.6);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #444; border-radius: 2px;
        }

        /* ç•«å¸ƒèˆ‡æ•¸æ“šå€ */
        #canvas-container { 
            width: 100%; max-width: 600px; 
            display: flex; justify-content: center; margin-bottom: 15px;
            position: relative;
        }
        canvas { border-radius: 4px; border: 1px solid #333; background: #080808; }

        /* çµæœé¡¯ç¤ºå„€è¡¨æ¿ */
        .dashboard {
            width: 100%; max-width: 600px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .meter {
            background: #1a1a1a; padding: 15px; border-radius: 12px;
            text-align: center; border: 1px solid #333;
        }
        .meter-title { font-size: 12px; color: #888; margin-bottom: 5px; }
        .meter-value { font-size: 24px; font-weight: bold; color: #fff; }
        .meter-unit { font-size: 14px; color: #666; }
        
        .highlight-g { color: #00ff00; } /* ç¶ è‰²ï¼šæœ‰èƒ½é‡ */
        .highlight-r { color: #ff4444; } /* ç´…è‰²ï¼šèƒ½é‡ä¸è¶³ */
    </style>
</head>
<body>
    <div class="nav"><a href="../index.html">â† è¿”å›é¦–é </a></div>

    <div class="controls-container">
        <div class="slider-group">
            <div class="slider-label">
                å…¥å°„å…‰é »ç‡ (f)
                <b id="val_f">10.0</b> <span style="font-size:0.8em; color:#888;">x10Â¹â´ Hz</span>
            </div>
            <input type="range" id="sl_f" min="2.0" max="20.0" value="10.0" step="0.1">
        </div>

        <div class="slider-group">
            <div class="slider-label">
                å…‰å¼·åº¦ (I) - å…‰å­æ•¸å¯†åº¦
                <b id="val_I">5.0</b> <span style="font-size:0.8em; color:#888;">W/mÂ²</span>
            </div>
            <input type="range" id="sl_I" min="0.0" max="10.0" value="5.0" step="0.5">
        </div>

        <div class="slider-group">
            <div class="slider-label">
                é‡‘å±¬åŠŸå‡½æ•¸ (W)
                <b id="val_W">2.50</b> <span style="font-size:0.8em; color:#888;">eV</span>
            </div>
            <input type="range" id="sl_W" min="1.0" max="6.0" value="2.50" step="0.05">
        </div>
    </div>

    <div id="canvas-container"></div>

    <div class="dashboard">
        <div class="meter">
            <div class="meter-title">å…‰å­èƒ½é‡ (E=hf)</div>
            <div id="disp_E" class="meter-value">4.14</div>
            <span class="meter-unit">eV</span>
        </div>
        <div class="meter" style="border-color: #00d4ff;">
            <div class="meter-title">é›»å­æœ€å¤§å‹•èƒ½ (Kmax)</div>
            <div id="disp_K" class="meter-value highlight-g">1.64</div>
            <span class="meter-unit">eV</span>
        </div>
    </div>

    <script>
        let sl_f, sl_W, sl_I;
        let electrons = [];
        let photons = [];
        let metalY;
        let canvasW, canvasH;
        
        // ç‰©ç†å¸¸æ•¸
        // h å–®ä½æ›ç®—ä¿®æ­£å¾Œ: E(eV) = h * f(10^14 Hz)
        const H_CONST = 0.41357; 

        function setup() {
            canvasW = min(windowWidth - 20, 600);
            canvasH = 320; // ç¨å¾®åŠ é«˜ä»¥å®¹ç´æ–‡å­—
            let cnv = createCanvas(canvasW, canvasH);
            cnv.parent('canvas-container');
            
            sl_f = select('#sl_f');
            sl_W = select('#sl_W');
            sl_I = select('#sl_I'); // æ–°å¢å¼·åº¦æ§åˆ¶
            
            metalY = height - 50; 
        }

        function draw() {
            background(10);
            
            // è®€å–æ•¸å€¼
            let f_val = float(sl_f.value());
            let W_val = float(sl_W.value());
            let I_val = float(sl_I.value()); // å¼·åº¦
            
            // è¨ˆç®—ç‰©ç†é‡
            let E_photon = f_val * H_CONST;
            let K_max = E_photon - W_val;
            
            // è¨ˆç®—åº•é™é »ç‡ f0 = W / h
            let f0 = W_val / H_CONST;

            // UI æ›´æ–°
            select('#val_f').html(f_val.toFixed(1));
            select('#val_W').html(W_val.toFixed(2));
            select('#val_I').html(I_val.toFixed(1));
            select('#disp_E').html(E_photon.toFixed(2));
            
            let kDisplay = select('#disp_K');
            if (K_max > 0) {
                kDisplay.html(K_max.toFixed(2));
                kDisplay.class("meter-value highlight-g");
            } else {
                kDisplay.html("0.00");
                kDisplay.class("meter-value highlight-r");
            }

            // 1. å…‰å­ç™¼å°„é‚è¼¯ (ç”±å¼·åº¦ I æ§åˆ¶)
            // I è¶Šå¤§ï¼Œå–®ä½æ™‚é–“ç”¢ç”Ÿçš„å…‰å­æ©Ÿç‡è¶Šé«˜
            if (I_val > 0) {
                let emissionProb = map(I_val, 0, 10, 0, 0.3); // èª¿æ•´ç™¼å°„æ©Ÿç‡
                if (random(1) < emissionProb) {
                    emitPhoton(f_val);
                }
            }

            // 2. ç¹ªè£½æ‰‹é›»ç­’
            drawFlashlight(f_val, I_val);

            // 3. è™•ç†å…‰å­å‹•ç•«
            let photonColor = freqToColor(f_val);
            for (let i = photons.length - 1; i >= 0; i--) {
                let p = photons[i];
                p.update();
                p.display(photonColor);
                
                // æ’æ“Šé‡‘å±¬åµæ¸¬
                if (p.pos.y >= metalY && p.pos.x > 50 && p.pos.x < width - 50) {
                    // åªæœ‰ç•¶èƒ½é‡å¤§æ–¼åŠŸå‡½æ•¸æ™‚ï¼Œæ‰"æœ‰æ©Ÿç‡"æ‰“å‡ºé›»å­
                    // (ä¸¦éæ¯é¡†å…‰å­éƒ½ä¸€å®šæ‰“å‡ºé›»å­ï¼Œé€™è£¡ç‚ºäº†æ•ˆæœç°¡åŒ–ç‚º 100% è½‰æ›ï¼Œåªè¦èƒ½é‡å¤ )
                    if (K_max > 0) {
                        spawnElectron(p.pos.x, K_max);
                    }
                    photons.splice(i, 1); 
                } else if (p.pos.y > height || p.pos.x > width) {
                    photons.splice(i, 1);
                }
            }

            // 4. è™•ç†é›»å­å‹•ç•«
            for (let i = electrons.length - 1; i >= 0; i--) {
                let e = electrons[i];
                e.update();
                e.display();
                if (e.pos.y < 0 || e.pos.x > width || e.pos.x < 0) {
                    electrons.splice(i, 1);
                }
            }

            // 5. ç¹ªè£½é‡‘å±¬æ¿èˆ‡è³‡è¨Š
            drawMetal(W_val, f0, K_max > 0);
        }

        // --- è¼”åŠ©å‡½æ•¸ ---

        function emitPhoton(freq) {
            let startX = 60;
            let startY = 60;
            let targetX = random(100, width - 50);
            let targetY = metalY;
            photons.push(new Photon(startX, startY, targetX, targetY));
        }

        function spawnElectron(x, k_max) {
            let speed = sqrt(k_max) * 2.0; // ç¨å¾®èª¿æ…¢é›»å­é€Ÿåº¦ä¿‚æ•¸ (å¾2.5æ”¹ç‚º2.0)
            let angle = random(-PI/3, -2*PI/3); 
            electrons.push(new Electron(x, metalY - 5, speed, angle));
        }

        class Photon {
            constructor(x, y, tx, ty) {
                this.pos = createVector(x, y);
                let dir = createVector(tx - x, ty - y);
                dir.normalize();
                this.vel = dir.mult(4); // **é€Ÿåº¦èª¿æ…¢** (åŸç‚º 8ï¼Œç¾åœ¨æ”¹ç‚º 4ï¼Œæ–¹ä¾¿è‚‰çœ¼è§€å¯Ÿ)
                this.w = 0; 
            }
            update() {
                this.pos.add(this.vel);
                this.w += 0.5;
            }
            display(c) {
                push();
                stroke(c);
                strokeWeight(2);
                noFill();
                translate(this.pos.x, this.pos.y);
                rotate(this.vel.heading());
                // ç•«å‡ºå°æ³¢åŒ… (å…‰å­)
                beginShape();
                for(let i=-8; i<8; i+=2) {
                    vertex(i, sin(i*0.6 + this.w)*3);
                }
                endShape();
                pop();
            }
        }

        class Electron {
            constructor(x, y, speed, angle) {
                this.pos = createVector(x, y);
                this.vel = p5.Vector.fromAngle(angle).mult(speed);
            }
            update() {
                this.pos.add(this.vel);
            }
            display() {
                push();
                translate(this.pos.x, this.pos.y);
                noStroke();
                fill(0, 255, 255, 120); // é›»å­å…‰æšˆ
                ellipse(0, 0, 10, 10);
                fill(255); // é›»å­æ ¸å¿ƒ
                ellipse(0, 0, 4, 4);
                pop();
            }
        }

        function drawFlashlight(freq, intensity) {
            push();
            translate(40, 40);
            rotate(PI/6);
            
            let c = freqToColor(freq);
            
            // ç­’èº«
            fill(50); stroke(100); strokeWeight(1);
            rect(0, -15, 60, 30, 5);
            // ç‡ˆé ­
            fill(80);
            rect(60, -20, 10, 40, 2);
            
            // ç™¼å…‰è™• (æ ¹æ“šå¼·åº¦æ”¹è®Šé€æ˜åº¦)
            let alpha = map(intensity, 0, 10, 50, 255);
            fill(red(c), green(c), blue(c), alpha); 
            noStroke();
            ellipse(70, 0, 15, 30);
            
            // å…‰æŸå…‰æšˆ (åªæœ‰ç•¶å¼·åº¦ > 0 æ‰é¡¯ç¤º)
            if (intensity > 0.1) {
                fill(red(c), green(c), blue(c), map(intensity, 0, 10, 10, 60));
                triangle(70, -10, 70, 10, 400, 150);
            }
            
            pop();
        }

        function drawMetal(W, f0, isActive) {
            // é‡‘å±¬å¡Š
            fill(30); stroke(100); strokeWeight(1);
            rect(50, metalY, width-100, 40); // åŠ åšä¸€é»
            
            stroke(60);
            for(let i=60; i<width-60; i+=20) {
                line(i, metalY, i+10, metalY+40);
            }

            // æ–‡å­—æ¨™ç¤ºå€
            noStroke(); 
            textAlign(CENTER);
            
            // ç¬¬ä¸€è¡Œï¼šé‡‘å±¬åŠŸå‡½æ•¸
            fill(200); textSize(14);
            text(`Metal (W = ${W.toFixed(2)} eV)`, width/2, metalY + 20);
            
            // ç¬¬äºŒè¡Œï¼šåº•é™é »ç‡ (é€™æ˜¯ä½ è¦æ±‚æ–°å¢çš„)
            fill(0, 212, 255); textSize(12);
            text(`åº•é™é »ç‡ fâ‚€ = ${f0.toFixed(2)} x10Â¹â´ Hz`, width/2, metalY + 36);
            
            // ç‹€æ…‹è­¦ç¤º
            if (!isActive) {
                fill(255, 50, 50); textSize(12);
                text("ğŸš« èƒ½é‡ä¸è¶³ ( f < fâ‚€ )", width/2, metalY - 10);
            }
        }

        function freqToColor(f) {
            if (f < 3.0) return color(120, 0, 0); 
            if (f > 15.0) return color(100, 0, 220); 
            let h = map(f, 3.0, 15.0, 0, 280);
            colorMode(HSB, 360, 100, 100);
            let c = color(h, 100, 100);
            colorMode(RGB);
            return c;
        }

        function windowResized() {
            canvasW = min(windowWidth - 20, 600);
            resizeCanvas(canvasW, 320);
            metalY = height - 50;
        }
    </script>
</body>
</html>
